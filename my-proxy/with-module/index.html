<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <table>
        
        <tbody>
            
            <tr>
                <td>
                    <input type="text" data-name="custNm">
                </td>
                <td>
                    <input type="text" data-name="age" >
                </td>
                <td>
                    <label><input type="radio" data-name="hasCar" value="Y">Y</label>
                    <label><input type="radio" data-name="hasCar" value="N">N</label>
                </td>
                <td>
                    select:<select data-name="status">
                        <option value="00">00</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                    </select>
                </td>
                <td>
                    A<input type="checkbox" data-name="chk" value="A"></br>
                    B<input type="checkbox" data-name="chk" value="B"></br>
                    C<input type="checkbox" data-name="chk" value="C"></br>
                    D<input type="checkbox" data-name="chk" value="D"></br>
                    E<input type="checkbox" data-name="chk" value="E"></br>
                </td>
            </tr>
            <tr id="tr2">
                <td>
                    <input type="text" data-name="custNm">
                </td>
                <td>
                    <input type="text" data-name="age" >
                </td>
                <td>
                    <label><input type="radio" data-name="hasCar" value="Y">Y</label>
                    <label><input type="radio" data-name="hasCar" value="N">N</label>
                </td>
                <td>
                    select:<select data-name="status">
                        <option value="00">00</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                    </select>
                </td>
                <td>
                    A<input type="checkbox" data-name="chk" value="A"></br>
                    B<input type="checkbox" data-name="chk" value="B"></br>
                    C<input type="checkbox" data-name="chk" value="C"></br>
                    D<input type="checkbox" data-name="chk" value="D"></br>
                    E<input type="checkbox" data-name="chk" value="E"></br>
                </td>
            </tr>
        </tbody>
    </table>
</body>
<script type="module">
    import myProxy from "./my-proxy-module.js";
    var getHandlers = [];
    var setHandlers2 = [];
    var listener = (recordProxy, event) => {
        var {target, prop, newValue} = event;
        if (target.key === "status") {
            recordProxy.custNm.disabled = (newValue === "01");
        }
    }
    var listener2 = (recordProxy, event) => {
        var {target, prop, newValue} = event;
        if (target.key === "age") {
            target.element.forEach(input => {
                Array.from(input.closest("td").querySelectorAll(".error")).forEach(err=>err.remove());
                if (input.value !== "" && !/^\d{1,}$/.test(input.value)) {
                    var error = document.createElement("p");
                    error.classList.add("error");
                    error.innerText = "number only";
                    input.closest("td").appendChild(error);
                }
            });
            
        }
    }
    Array.from(document.querySelectorAll("tr")).forEach(tr=>{
        var t2 = myProxy(tr, "data-name", getHandlers, setHandlers2);
        var unsubscribe = t2.addChangeListener(listener);
        var unsubscribe2 = t2.addChangeListener(listener2);
        tr["_proxy"]= t2;
    })
</script>

</html>